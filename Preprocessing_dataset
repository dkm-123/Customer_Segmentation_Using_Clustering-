import pandas as pd

# Load dataset
df = pd.read_csv("Customer_dataset.csv")

#Remove rows with missing values
df.dropna(subset=['CustomerID', 'Description'], inplace=True)

#Remove rows with negative or zero Quantity & UnitPrice
df = df[(df['Quantity'] > 0) & (df['UnitPrice'] > 0)]

#Convert InvoiceDate to datetime
df['InvoiceDate'] = pd.to_datetime(df['InvoiceDate'], dayfirst=True, errors='coerce')

#Filter: Keep only rows that are numeric StockCodes AND not 'POST' + 'POSTAGE'
df = df[
    (df['StockCode'].astype(str).str.match(r'^\d+$')) & 
    ~((df['StockCode'].str.upper() == 'POST') & (df['Description'].str.upper() == 'POSTAGE'))
]

#Remove rows where InvoiceDate failed to parse
df = df.dropna(subset=['InvoiceDate'])

#Format InvoiceDate as DD-MM-YYYY for output
df['InvoiceDate'] = df['InvoiceDate'].dt.strftime('%d-%m-%Y')

#Remove duplicates if any
df.drop_duplicates(inplace=True)

#Reset index after cleaning
df.reset_index(drop=True, inplace=True)

#Save cleaned dataset
df.to_csv("Customer_clean.csv", index=False)

print("âœ… Cleaning complete! Cleaned file saved as 'Customer_clean.csv'")
